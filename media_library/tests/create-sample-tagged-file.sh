#!/usr/bin/env bash

# Create a temporary test file with tags

TMPDIR=$(mktemp -d)
TESTFILE="$TMPDIR/test-image.jpg"

# Create a minimal JPEG (1x1 pixel)
echo -n -e '\xFF\xD8\xFF\xE0\x00\x10\x4A\x46\x49\x46\x00\x01\x01\x01\x00\x48\x00\x48\x00\x00\xFF\xDB\x00\x43\x00\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xC0\x00\x0B\x08\x00\x01\x00\x01\x01\x01\x11\x00\xFF\xC4\x00\x14\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xDA\x00\x08\x01\x01\x00\x00\x3F\x00\x7F\xFF\xD9' > "$TESTFILE"

echo "Created test file: $TESTFILE"

# Add various tags using exiftool
exiftool -overwrite_original \
  -Subject="TestTag" \
  -Keywords="Simple, Flat, Tags" \
  -HierarchicalSubject="Location|Inside|Bedroom" \
  -HierarchicalSubject="Location|Outside|Garden" \
  -Categories="Category1" \
  "$TESTFILE"

echo "Tags added to test file"
echo ""
echo "Verifying tags:"
exiftool -Subject -Keywords -HierarchicalSubject -Categories "$TESTFILE"
echo ""
echo "Test file ready at: $TESTFILE"
echo "Run: ./process-tags-to-db $TESTFILE"
